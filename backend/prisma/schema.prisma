// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  // ⚠️ Prisma CLI(migrate/studio)는 여기 env("DB_URL")를 꼭 필요로 합니다.
  // 앱 런타임에서 DB_URL을 코드로 조합하더라도,
  // 마이그레이션을 위해 .env.dev / .env.prod 에 DB_URL은 남겨두세요.
  url      = env("DB_URL")
}

// Enum
enum UserRole {
  USER
  COMPANY
  ADMIN
}

// Model
model User {
  id           Int       @id @default(autoincrement())            // PK
  user_id      String    @unique @db.VarChar(50)                   // 비즈니스용 ID(로그인 ID 등)
  user_name    String    @db.VarChar(100)
  user_email   String    @unique @db.VarChar(255)
  user_password String   @db.VarChar(255)                          // 해시 저장 권장(BCrypt 등)
  user_role      UserRole  @default(USER)
  created_at   DateTime  @default(now())
  update_at    DateTime  @updatedAt

  // Relation
  tokens       UserToken[]

  @@map("tb_user")
  @@index([user_email])
  @@index([user_id])
}

model UserToken {
  id          Int       @id @default(autoincrement())
  jti         String    @unique @db.VarChar(128)                   // JWT ID 등
  token_hash  String    @db.VarChar(255)                           // 토큰 해시(원문 저장 금지)
  user_id     Int
  revoked     Boolean   @default(false)
  user_agent  String?   @db.VarChar(255)
  ip          String?   @db.VarChar(45)                            // IPv4/IPv6
  expires_at  DateTime
  last_used_at DateTime? @default(now())
  created_at  DateTime  @default(now())

  // FK
  user        User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("tb_user_token")
  @@index([user_id])
}